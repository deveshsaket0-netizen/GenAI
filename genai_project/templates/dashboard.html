{% extends 'base.html' %}

{% block title %}Dashboard | GovExam AI{% endblock %}

{% block content %}
<section class="card stats-row">
    <div><h3>Average Quiz Score</h3><p class="metric">{{ average_score }}</p></div>
    <div><h3>Study Streak</h3><p class="metric">{{ study_streak }} days</p></div>
</section>

<section class="card">
    <h2>Performance Trends</h2>
    <canvas id="subjectChart" height="120"></canvas>
</section>

<section class="card two-col">
    <div>
        <h3>Strong Subjects</h3>
        <ul class="list-clean">
            {% for subject in strong_subjects %}<li>{{ subject }}</li>{% empty %}<li>No data yet</li>{% endfor %}
        </ul>
    </div>
    <div>
        <h3>Weak Subjects</h3>
        <ul class="list-clean">
            {% for subject in weak_subjects %}<li>{{ subject }}</li>{% empty %}<li>No data yet</li>{% endfor %}
        </ul>
    </div>
</section>

<section class="card">
    <h3>Frequently Incorrect Topics</h3>
    <ul class="list-clean">
        {% for topic in top_weak_topics %}<li>{{ topic }}</li>{% empty %}<li>No weak topics identified yet</li>{% endfor %}
    </ul>
</section>

<section class="card">
    <h2>Activity History</h2>
    <table class="table">
        <thead><tr><th>Date</th><th>Subject</th><th>Score</th></tr></thead>
        <tbody>
        {% for item in activity_history %}
            <tr>
                <td>{{ item.created_at|date:"d M Y" }}</td>
                <td>{{ item.subject }}</td>
                <td>{{ item.score }}/{{ item.total_questions }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="3">No quizzes attempted yet.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</section>

<script>
const labels = {{ chart_labels|safe }};
const values = {{ chart_values|safe }};
const ctx = document.getElementById('subjectChart');
if (ctx && labels.length) {
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{ label: 'Average Score by Subject', data: values, borderColor: '#2563eb', fill: false, tension: 0.2 }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });
}
</script>
{% endblock %}
